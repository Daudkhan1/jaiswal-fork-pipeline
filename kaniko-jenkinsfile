pipeline {
    agent { label 'jenkins-agent' }
    environment {
        REGISTRY = 'daudidrees'
        IMAGE = 'my-kaniko-image'
        TAG = 'latest'
    }
    stages {
        stage('Build and Push with Kaniko') {
            steps {
                sh '''
                # Run Kaniko to build and push the image
                /usr/local/bin/kaniko \
                    --dockerfile=Dockerfile \
                    --context=$(pwd) \
                    --destination=${REGISTRY}/${IMAGE}:${TAG}
                '''
            }
        }
    }
}
